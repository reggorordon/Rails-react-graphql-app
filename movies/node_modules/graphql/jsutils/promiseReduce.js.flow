/**
<<<<<<< HEAD
 * Copyright (c) Facebook, Inc. and its affiliates.
=======
 * Copyright (c) 2015-present, Facebook, Inc.
>>>>>>> b22d4f639358533e1bbd355b77d7a3342c6a63e8
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 *
 * @flow strict
 */

import isPromise from './isPromise';
<<<<<<< HEAD
import type { PromiseOrValue } from './PromiseOrValue';
=======
import type { MaybePromise } from './MaybePromise';
>>>>>>> b22d4f639358533e1bbd355b77d7a3342c6a63e8

/**
 * Similar to Array.prototype.reduce(), however the reducing callback may return
 * a Promise, in which case reduction will continue after each promise resolves.
 *
 * If the callback does not return a Promise, then this function will also not
 * return a Promise.
 */
export default function promiseReduce<T, U>(
  values: $ReadOnlyArray<T>,
<<<<<<< HEAD
  callback: (U, T) => PromiseOrValue<U>,
  initialValue: PromiseOrValue<U>,
): PromiseOrValue<U> {
=======
  callback: (U, T) => MaybePromise<U>,
  initialValue: MaybePromise<U>,
): MaybePromise<U> {
>>>>>>> b22d4f639358533e1bbd355b77d7a3342c6a63e8
  return values.reduce(
    (previous, value) =>
      isPromise(previous)
        ? previous.then(resolved => callback(resolved, value))
        : callback(previous, value),
    initialValue,
  );
}
